"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var t=require("react-leaflet"),s=require("leaflet"),o=e(require("react")),n=require("react-dom"),r=e(require("prop-types"));
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
function a(e,t,s,o){return new(s||(s=Promise))((function(n,r){function a(e){try{l(o.next(e))}catch(e){r(e)}}function i(e){try{l(o.throw(e))}catch(e){r(e)}}function l(e){e.done?n(e.value):new s((function(t){t(e.value)})).then(a,i)}l((o=o.apply(e,t||[])).next())}))}var i={OpenStreetMap:class{constructor(e){let t="",s="";if(e&&e.searchBounds&&e.searchBounds.length){t=`&bounded=1&viewbox=${e.searchBounds.reduce((e,t)=>[...e,t.lng,t.lat],[]).join(",")}`}e&&"region"in e&&(s=`&countrycodes=${e.region}`),this.url=`https://nominatim.openstreetmap.org/search?format=json&addressdetails=1&polygon_svg=1&namedetails=1${t}${s}&q=`}search(e){return a(this,void 0,void 0,(function*(){const t=yield fetch(this.url+e),s=yield t.json();return this.formatResponse(s)}))}formatResponse(e){const t=e;return{info:e.length>0?t.map(e=>({bounds:e.boundingbox.map(e=>Number(e)),latitude:Number(e.lat),longitude:Number(e.lon),name:e.display_name})):"Not Found",raw:e}}},BingMap:class{constructor(e){var t,s,o;this.key=null===(t=e)||void 0===t?void 0:t.providerKey;let n="";if(null===(o=null===(s=e)||void 0===s?void 0:s.searchBounds)||void 0===o?void 0:o.length){n=`&umv=${e.searchBounds.reduce((e,t)=>[...e,t.lat,t.lng],[]).join(",")}`}this.url=`https://dev.virtualearth.net/REST/v1/Locations?output=json${n}&key=${this.key}&q=`}search(e){return a(this,void 0,void 0,(function*(){if(void 0===this.key)return{error:"BingMap requires an api key"};const t=yield fetch(this.url+e).then(e=>e.json());return this.formatResponse(t)}))}formatResponse(e){const t=e.resourceSets[0].resources;return{info:e.resourceSets[0].estimatedTotal>0?t.map(e=>({bounds:e.bbox.map(e=>Number(e)),latitude:Number(e.point.coordinates[0]),longitude:Number(e.point.coordinates[1]),name:e.name})):"Not Found",raw:e}}}};const l=o.forwardRef(({placeholder:e="PlaceHolder",type:t="text",initialValue:s="",className:n="",debounceTime:r=400,getInputValueSetter:a=(()=>{}),onClick:i=(()=>{}),onDoubleClick:l=(()=>{}),onMouseDown:c=(()=>{}),onMouseEnter:h=(()=>{}),onMouseLeave:p=(()=>{}),onChange:u=(()=>{}),onChangeAsync:d=(()=>{}),onFocus:m=(()=>{}),onBlur:f=(()=>{}),onKeyUp:v=(()=>{}),onKeyDown:g=(()=>{}),onKeyPress:y=(()=>{}),onSubmit:b=(()=>{}),tabIndex:k=0},S)=>{const[w,I]=o.useState(s),C=o.useCallback((e,t)=>{t(e)},[]),N=o.useCallback(function(e,t,s=400){let o;return n=>{n.persist(),t&&t(n),clearTimeout(o),o=window.setTimeout(()=>{e(n)},s)}}(e=>{e.preventDefault(),e.stopPropagation(),d(e)},e=>{e.preventDefault(),e.stopPropagation(),I(e.target.value),u(e)},r),[I]);return o.useLayoutEffect(()=>{a(I)}),o.createElement("input",{tabIndex:k,ref:S,type:t,name:"SearchInput",value:w,placeholder:e,className:`search-input${n?` ${n}`:""}`,onClick:e=>C(e,i),onDoubleClick:e=>C(e,l),onMouseEnter:e=>C(e,h),onMouseLeave:e=>C(e,p),onMouseDown:e=>C(e,c),onChange:N,onFocus:e=>C(e,m),onBlur:e=>C(e,f),onKeyUp:e=>C(e,v),onKeyDown:e=>C(e,g),onKeyPress:e=>C(e,y),onSubmit:e=>C(e,b)})});function c({className:e="",onClick:t=(e=>{e.preventDefault(),e.stopPropagation()})}){return o.createElement("button",{className:`search-control-close-button${e?` ${e}`:""}`,onClick:t},o.createElement("svg",{viewBox:"0 0 50 50"},o.createElement("path",{d:"M5 5 L45 45 M45 5 L5 45"}),"Sorry, your browser does not support inline SVG."))}function h({className:e="",onClick:t=(()=>{}),onMouseEnter:s=(()=>{}),onMouseLeave:n=(()=>{})}){return o.createElement("button",{className:`${e||""}`,onClick:t,onMouseEnter:s,onMouseLeave:n},o.createElement("svg",{viewBox:"0 0 50 50"},o.createElement("line",{x1:"35",y1:"35",x2:"46",y2:"46"}),o.createElement("circle",{cx:"23",cy:"23",r:"16",fill:"none"}),"Sorry, your browser does not support inline SVG."))}const p=({value:e,className:t,candidate:s,onClick:n,onKeyDown:r,children:a})=>{const i=o.useRef(null);return o.useEffect(()=>{e===s&&i.current&&i.current.offsetParent&&i.current.scrollIntoView({behavior:"smooth",block:"nearest"})},[s,e]),o.createElement("li",{ref:i,value:e,className:t,onClick:n,onKeyDown:r},a)},u=(e,t)=>{const{handler:s,list:n,tabIndex:r,activeIndex:a}=e,[i,l]=o.useState(0),c=o.useCallback(e=>{if(Array.isArray(n)){e.stopPropagation(),9!==e.keyCode&&e.preventDefault();const t=n.length;if((t<=i||i<0||13!==e.keyCode)&&32!==e.keyCode){const s=t<=i||i<0?0:i;38===e.keyCode?l(0===s?n.length-1:s-1):40===e.keyCode&&l(s+1===n.length?0:s+1)}else s(n[i],n,i)}},[l,i,n]);return o.useLayoutEffect(()=>l(0),[n]),Array.isArray(n)?o.createElement("ul",Object.assign({ref:t},void 0!==r?{tabIndex:e.tabIndex}:{},{className:"search-control-info-list",onKeyDown:c}),n.map((e,t)=>o.createElement(p,{value:t,candidate:i,key:`${e.name}-${t}`,className:`search-control-info-list-item${t===a||e.checked?" active":""}${i===t?" candidate":""}`,onClick:()=>{l(t),s(e,n,t)},onKeyDown:c},e.name))):o.createElement("span",{className:"search-control-info-span"},n)};u.displayName="SearchInfoList";const d=o.forwardRef(u);class m extends o.Component{constructor(e){if(super(e),this.setLock=e=>{this.lock=e},this.openSearch=()=>{this.setState({open:!0},()=>{var e;null===(e=this.input.current)||void 0===e||e.focus()})},this.closeSearch=()=>{this.setState({open:this.props.openSearchOnLoad,closeButton:!1,showInfo:!1},()=>{this.inputValueSetter(""),this.SearchResponseInfo="",this.props.removeMarker&&this.props.removeMarker({event:"remove"})})},this.aClick=e=>{e.preventDefault(),e.stopPropagation(),this.state.open?this.closeSearch():this.openSearch()},this.inputBlur=e=>{var t;""===(null===(t=this.input.current)||void 0===t?void 0:t.value)&&!this.lock&&this.closeSearch()},this.inputClick=e=>{var t,s,o;null===(t=this.input.current)||void 0===t||t.focus(),(null===(s=this.input.current)||void 0===s?void 0:s.value.startsWith(":"))||null===this.lastInfo||""===this.lastInfo||""===(null===(o=this.input.current)||void 0===o?void 0:o.value)||(this.SearchResponseInfo=this.lastInfo,this.lastInfo=null,this.setState({showInfo:!0}))},this.inputKeyUp=e=>{13===e.keyCode&&this.beautifyValue(this.input.current.value)},this.closeClick=e=>{this.closeSearch()},this.sendToAction=e=>a(this,void 0,void 0,(function*(){if(!this.input.current.value.startsWith(":"))if(Object.prototype.hasOwnProperty.call(this.responseCache,this.input.current.value))this.showInfo(this.responseCache[this.input.current.value].info);else if(this.input.current.value.length>=3){this.showInfo("Searching...");const e=yield this.provider.search(this.input.current.value);if(e.error)return!1;this.responseCache[this.input.current.value]=e,this.showInfo(e.info)}})),this.syncInput=()=>{var e,t;!this.state.closeButton&&this.setState({closeButton:!0}),""==(null===(e=this.input.current)||void 0===e?void 0:e.value)&&(this.hideInfo(),this.state.closeButton&&this.setState({closeButton:!1})),null===(t=this.input.current)||void 0===t||t.value.startsWith(":")},this.listItemClick=(e,t,o)=>{this.showInfo(t,o),this.props.handler&&this.props.handler({event:"add",payload:{latlng:new s.LatLng(Number(e.latitude),Number(e.longitude)),info:e.name,raw:this.responseCache[this.input.current.value]}}),this.props.closeResultsOnClick&&this.hideInfo()},this.setMaxHeight=()=>{const e=this.props.map?this.props.map.getContainer().getBoundingClientRect():document.body.getBoundingClientRect(),t=this.input.current.getBoundingClientRect(),s=`${Math.floor(.6*(e.bottom-t.bottom-10))}px`;this.selectbox.current&&this.selectbox.current.style&&(this.selectbox.current.style.maxHeight=s)},this.state={open:this.props.openSearchOnLoad,closeButton:!1,showInfo:!1},this.SearchResponseInfo="",this.responseCache={},this.lastInfo=null,this.inputValueSetter=()=>{},this.selectbox=o.createRef(),this.div=o.createRef(),this.input=o.createRef(),this.props.customProvider)this.provider=this.props.customProvider;else{if(!this.props.provider||!Object.keys(i).includes(this.props.provider))throw new Error(`You set the provider prop to ${this.props.provider} but that isn't recognised. You can choose from ${Object.keys(i).join(", ")}`);{const e=i[this.props.provider];this.provider=new e(this.props.providerOptions)}}}beautifyValue(e){if(e.startsWith(":")){const t=e.slice(1).split(",").filter(e=>!isNaN(Number(e))).map(e=>Number(e||0));t.length<=1?this.showInfo("Please enter a valid lat, lng"):(this.hideInfo(),this.props.handler&&this.props.handler({event:"add",payload:{latlng:new s.LatLng(Number(t[0]),Number(t[1])),info:t.join(","),raw:t.join(",")}}))}else if(this.input.current.value.length<3){const e='Please enter a valid lat,lng starting with ":" or minimum 3 character to search';this.showInfo(e)}}hideInfo(){this.lastInfo=this.SearchResponseInfo,this.SearchResponseInfo="",this.setState({showInfo:!1})}showInfo(e,t){var s;this.SearchResponseInfo=o.createElement(d,{ref:this.selectbox,activeIndex:t,list:e,handler:this.listItemClick,tabIndex:void 0!==this.props.tabIndex?this.props.tabIndex+1:2}),(null===(s=this.input.current)||void 0===s?void 0:s.value)&&this.setState({showInfo:!0})}componentDidMount(){if(this.setMaxHeight(),this.props.search&&!isNaN(Number(this.props.search.lat))&&!isNaN(Number(this.props.search.lng))){const e=`:${this.props.search.lat},${this.props.search.lng}`;this.inputValueSetter(e),this.openSearch(),this.syncInput(),this.props.handler&&this.props.handler({event:"add",payload:{latlng:new s.LatLng(Number(this.props.search.lat),Number(this.props.search.lng)),info:e,raw:this.props.search}})}}componentDidUpdate(){this.setMaxHeight(),this.state.showInfo}render(){return o.createElement("article",{className:`${this.props.className?`${this.props.className} `:""}search-control-wrap`},o.createElement("section",{className:`search-control${this.state.open?" search-control-active":""}`},o.createElement(h,{className:"search-control-icon-button",onClick:this.aClick,onMouseEnter:()=>this.setLock(!0),onMouseLeave:()=>this.setLock(!1)}),o.createElement(l,{tabIndex:void 0!==this.props.tabIndex?this.props.tabIndex:1,ref:this.input,getInputValueSetter:e=>this.inputValueSetter=e,className:"search-control-input",placeholder:this.props.inputPlaceholder,onClick:this.inputClick,onMouseEnter:()=>this.setLock(!0),onMouseLeave:()=>this.setLock(!1),onChange:this.syncInput,onChangeAsync:this.sendToAction,onBlur:this.inputBlur,onKeyUp:this.inputKeyUp,onKeyPress:e=>{e.stopPropagation(),40===e.keyCode&&e.preventDefault()},onKeyDown:e=>{var t;40===e.keyCode&&(e.preventDefault(),e.stopPropagation(),null===(t=this.selectbox.current)||void 0===t||t.focus())},onSubmit:e=>e.preventDefault()}),o.createElement(c,{className:this.state.closeButton?" search-control-close-button-active":"",onClick:this.closeClick})),o.createElement("section",{className:`search-control-info-wrapper${this.state.showInfo?"":" search-control-info-wrapper-close"}`},o.createElement("section",{ref:this.div,className:"search-control-info"},this.state.showInfo&&this.SearchResponseInfo)))}}m.propTypes={provider:r.string,providerKey:r.string,inputPlaceholder:r.string,coords:r.arrayOf(r.number),closeResultsOnClick:r.bool,openSearchOnLoad:r.bool,searchBounds:r.array,providerOptions:r.object},m.defaultProps={inputPlaceholder:"Search Lat,Lng",closeResultsOnClick:!1,openSearchOnLoad:!1,search:void 0,provider:"OpenStreetMap"};class f extends t.MapControl{constructor(e,t){var n;super(e),this.handler=({event:e,payload:t})=>{this.searchCallback&&this.searchCallback({event:e,payload:t}),"add"===e?t&&this.latLngHandler(t.latlng,t.info,t.raw):this.removeMarkerHandler()},this.div=s.DomUtil.create("div","leaflet-search-wrap"),s.DomEvent.disableClickPropagation(this.div),s.DomEvent.disableScrollPropagation(this.div),this.state={search:!1,info:!1},this.markerIcon=s.icon({iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.3.1/images/marker-icon.png",iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.3.1/images/marker-icon-2x.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.3.1/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]}),this.SearchInfo=null,this.map=t.map||(null===(n=e.leaflet)||void 0===n?void 0:n.map),this.markerRef=o.createRef(),e.searchCallback&&(this.searchCallback=e.searchCallback)}createLeafletElement(e){return new(s.Control.extend({onAdd:e=>this.div,onRemove:e=>{}}))(e)}latLngHandler(e,t,s){this.SearchInfo={info:t,latLng:e,raw:s};const n=o.createElement("div",null,o.createElement("p",null,Array.isArray(t)?t.toString():t),o.createElement("div",{className:"search-control-popup-seperator"}),o.createElement("div",null,`latitude: ${e.lat}`),o.createElement("div",null,`longitude: ${e.lng}`));this.goToLatLng(e,n)}removeMarkerHandler(){this.setState({search:!1})}goToLatLng(e,t){this.setState({search:e,info:t},()=>{this.flyTo()})}flyTo(){if(this.state.search)switch(this.props.mapStateModifier){case"flyTo":this.map&&this.map.flyTo(this.state.search,this.props.zoom,this.props.zoomPanOptions);break;case"setView":this.map&&this.map.setView(this.state.search,this.props.zoom,this.props.zoomPanOptions);break;default:"function"==typeof this.props.mapStateModifier&&this.props.mapStateModifier(this.state.search)}}componentDidMount(){super.componentDidMount&&super.componentDidMount(),n.createPortal(o.createElement(m,Object.assign({className:this.props.className,provider:this.props.provider,customProvider:this.props.customProvider,providerOptions:this.props.providerOptions,openSearchOnLoad:this.props.openSearchOnLoad,closeResultsOnClick:this.props.closeResultsOnClick,inputPlaceholder:this.props.inputPlaceholder,search:this.props.search,map:this.map,handler:this.handler,removeMarker:this.handler},void 0!==this.props.tabIndex?{tabIndex:this.props.tabIndex}:{})),this.div)}componentDidUpdate(){this.markerRef.current&&this.markerRef.current.leafletElement.openPopup()}defaultPopUp(){return o.createElement(t.Popup,null,o.createElement("span",null,this.state.info))}render(){return this.SearchInfo&&this.state.search&&this.props.showMarker?o.createElement(t.Marker,{ref:this.markerRef,icon:this.props.markerIcon||this.markerIcon,key:`marker-search-${this.state.search.toString()}`,position:this.state.search},this.props.showPopup&&(this.props.popUp?this.props.popUp(this.SearchInfo):this.defaultPopUp())):null}}f.defaultProps={inputPlaceholder:"Search Lat,Lng",showMarker:!0,showPopup:!0,zoom:10,closeResultsOnClick:!1,openSearchOnLoad:!1,search:void 0,provider:"OpenStreetMap",mapStateModifier:"flyTo",zoomPanOptions:{animate:!0,duration:.25,easeLinearity:.25,noMoveStart:!1}};var v=t.withLeaflet(f);module.exports=v;
